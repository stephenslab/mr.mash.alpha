<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Multiple Regression with Multivariate Adaptive Shrinkage from summary data. — mr.mash.rss • mr.mashr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple Regression with Multivariate Adaptive Shrinkage from summary data. — mr.mash.rss"><meta property="og:description" content="Performs multivariate multiple regression with
  mixture-of-normals prior."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mr.mashr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.43</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/stephenslab/mr.mashr" class="external-link">Source</a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multiple Regression with Multivariate Adaptive Shrinkage from summary data.</h1>
    <small class="dont-index">Source: <a href="https://github.com/stephenslab/mr.mashr/blob/HEAD/R/mr_mash_rss.R" class="external-link"><code>R/mr_mash_rss.R</code></a></small>
    <div class="hidden name"><code>mr.mash.rss.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Performs multivariate multiple regression with
  mixture-of-normals prior.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mr.mash.rss</span><span class="op">(</span></span>
<span>  <span class="va">Bhat</span>,</span>
<span>  <span class="va">Shat</span>,</span>
<span>  <span class="va">Z</span>,</span>
<span>  <span class="va">R</span>,</span>
<span>  <span class="va">covY</span>,</span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">S0</span>,</span>
<span>  w0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">S0</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">S0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">V</span>,</span>
<span>  mu1_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.0001</span>,</span>
<span>  convergence_criterion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu1"</span>, <span class="st">"ELBO"</span><span class="op">)</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  update_w0 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  update_w0_method <span class="op">=</span> <span class="st">"EM"</span>,</span>
<span>  w0_penalty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">S0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  update_w0_max_iter <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  w0_threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  compute_ELBO <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  update_V <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  update_V_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full"</span>, <span class="st">"diagonal"</span><span class="op">)</span>,</span>
<span>  version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rcpp"</span>, <span class="st">"R"</span><span class="op">)</span>,</span>
<span>  e <span class="op">=</span> <span class="fl">1e-08</span>,</span>
<span>  ca_update_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"consecutive"</span>, <span class="st">"decreasing_logBF"</span>, <span class="st">"increasing_logBF"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>  X_colmeans <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y_colmeans <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check_R <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  R_tol <span class="op">=</span> <span class="fl">1e-08</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-bhat">Bhat<a class="anchor" aria-label="anchor" href="#arg-bhat"></a></dt>
<dd><p>p x r matrix of regression coefficients from univariate
simple linear regression.</p></dd>


<dt id="arg-shat">Shat<a class="anchor" aria-label="anchor" href="#arg-shat"></a></dt>
<dd><p>p x r matrix of standard errors of the regression coefficients
from univariate simple linear regression.</p></dd>


<dt id="arg-z">Z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>p x r matrix of Z-scores from univariate
simple linear regression.</p></dd>


<dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>p x p dense or sparse correlation matrix among the variables.</p></dd>


<dt id="arg-covy">covY<a class="anchor" aria-label="anchor" href="#arg-covy"></a></dt>
<dd><p>r x r covariance matrix across responses.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>scalar indicating the sample size.</p></dd>


<dt id="arg-s-">S0<a class="anchor" aria-label="anchor" href="#arg-s-"></a></dt>
<dd><p>List of length K containing the desired r x r prior
covariance matrices on the regression coefficients.</p></dd>


<dt id="arg-w-">w0<a class="anchor" aria-label="anchor" href="#arg-w-"></a></dt>
<dd><p>K-vector with prior mixture weights, each associated with
the respective covariance matrix in <code>S0</code>.</p></dd>


<dt id="arg-v">V<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>r x r residual covariance matrix.</p></dd>


<dt id="arg-mu-init">mu1_init<a class="anchor" aria-label="anchor" href="#arg-mu-init"></a></dt>
<dd><p>p x r matrix of initial estimates of the posterior
mean regression coefficients. These should be on the same scale as
the X provided. If <code>standardize=TRUE</code>, mu1_init will be scaled
appropriately after standardizing X.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>Convergence tolerance.</p></dd>


<dt id="arg-convergence-criterion">convergence_criterion<a class="anchor" aria-label="anchor" href="#arg-convergence-criterion"></a></dt>
<dd><p>Criterion to use for convergence check.</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>Maximum number of iterations for the optimization
algorithm.</p></dd>


<dt id="arg-update-w-">update_w0<a class="anchor" aria-label="anchor" href="#arg-update-w-"></a></dt>
<dd><p>If <code>TRUE</code>, prior weights are updated.</p></dd>


<dt id="arg-update-w-method">update_w0_method<a class="anchor" aria-label="anchor" href="#arg-update-w-method"></a></dt>
<dd><p>Method to update prior weights. Only EM is
currently supported.</p></dd>


<dt id="arg-w-penalty">w0_penalty<a class="anchor" aria-label="anchor" href="#arg-w-penalty"></a></dt>
<dd><p>K-vector of penalty terms (&gt;=1) for each
mixture component. Default is all components are unpenalized.</p></dd>


<dt id="arg-update-w-max-iter">update_w0_max_iter<a class="anchor" aria-label="anchor" href="#arg-update-w-max-iter"></a></dt>
<dd><p>Maximum number of iterations for the update
of w0.</p></dd>


<dt id="arg-w-threshold">w0_threshold<a class="anchor" aria-label="anchor" href="#arg-w-threshold"></a></dt>
<dd><p>Drop mixture components with weight less than this value.
Components are dropped at each iteration after 15 initial iterations.
This is done to prevent from dropping some potentially important
components prematurely.</p></dd>


<dt id="arg-compute-elbo">compute_ELBO<a class="anchor" aria-label="anchor" href="#arg-compute-elbo"></a></dt>
<dd><p>If <code>TRUE</code>, ELBO is computed.</p></dd>


<dt id="arg-standardize">standardize<a class="anchor" aria-label="anchor" href="#arg-standardize"></a></dt>
<dd><p>If <code>TRUE</code>, X is "standardized" using the
sample means and sample standard deviations. Standardizing X
allows a faster implementation, but the prior has a different
interpretation. Coefficients and covariances are returned on the
original scale.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>If <code>TRUE</code>, some information about the
algorithm's process is printed at each iteration.</p></dd>


<dt id="arg-update-v">update_V<a class="anchor" aria-label="anchor" href="#arg-update-v"></a></dt>
<dd><p>if <code>TRUE</code>, residual covariance is updated.</p></dd>


<dt id="arg-update-v-method">update_V_method<a class="anchor" aria-label="anchor" href="#arg-update-v-method"></a></dt>
<dd><p>Method to update residual covariance. So far,
"full" and "diagonal" are supported. If <code>update_V=TRUE</code> and V
is not provided by the user, this option will determine how V is
computed (and fixed) internally from <code>mu1_init</code>.</p></dd>


<dt id="arg-version">version<a class="anchor" aria-label="anchor" href="#arg-version"></a></dt>
<dd><p>Whether to use R or C++ code to perform the
coordinate ascent updates.</p></dd>


<dt id="arg-e">e<a class="anchor" aria-label="anchor" href="#arg-e"></a></dt>
<dd><p>A small number to add to the diagonal elements of the
prior matrices to improve numerical stability of the updates.</p></dd>


<dt id="arg-ca-update-order">ca_update_order<a class="anchor" aria-label="anchor" href="#arg-ca-update-order"></a></dt>
<dd><p>The order with which coordinates are
updated.  So far, "consecutive", "decreasing_logBF",
"increasing_logBF", "random" are supported.</p></dd>


<dt id="arg-x-colmeans">X_colmeans<a class="anchor" aria-label="anchor" href="#arg-x-colmeans"></a></dt>
<dd><p>a p-vector of variable means.</p></dd>


<dt id="arg-y-colmeans">Y_colmeans<a class="anchor" aria-label="anchor" href="#arg-y-colmeans"></a></dt>
<dd><p>a r-vector of response means.</p></dd>


<dt id="arg-check-r">check_R<a class="anchor" aria-label="anchor" href="#arg-check-r"></a></dt>
<dd><p>If <code>TRUE</code>, R is checked to be positive semidefinite.</p></dd>


<dt id="arg-r-tol">R_tol<a class="anchor" aria-label="anchor" href="#arg-r-tol"></a></dt>
<dd><p>tolerance to declare positive semi-definiteness of R.</p></dd>


<dt id="arg-nthreads">nthreads<a class="anchor" aria-label="anchor" href="#arg-nthreads"></a></dt>
<dd><p>Number of RcppParallel threads to use for the
updates. When <code>nthreads</code> is <code>NA</code>, the default number of
threads is used; see
<code><a href="https://rdrr.io/pkg/RcppParallel/man/setThreadOptions.html" class="external-link">defaultNumThreads</a></code>. This setting is
ignored when <code>version = "R"</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A mr.mash.rss fit, stored as a list with some or all of the
following elements:</p>
<dl><dt>mu1</dt>
<dd><p>p x r matrix of posterior means for the regression
  coeffcients.</p></dd>


<dt>S1</dt>
<dd><p>r x r x p array of posterior covariances for the
  regression coeffcients.</p></dd>


<dt>w1</dt>
<dd><p>p x K matrix of posterior assignment probabilities to the
  mixture components.</p></dd>


<dt>V</dt>
<dd><p>r x r residual covariance matrix</p></dd>


<dt>w0</dt>
<dd><p>K-vector with (updated, if <code>update_w0=TRUE</code>) prior mixture weights, each associated with
  the respective covariance matrix in <code>S0</code></p></dd>
</dl><p>.</p>
<dl><dt>S0</dt>
<dd><p>r x r x K array of prior covariance matrices
  on the regression coefficients</p></dd>
</dl><p>.</p>
<dl><dt>intercept</dt>
<dd><p>r-vector containing posterior mean estimate of the
  intercept, if <code>X_colmeans</code> and <code>Y_colmeans</code> are provided.
  Otherwise, <code>NA</code> is output.</p></dd>


<dt>ELBO</dt>
<dd><p>Evidence Lower Bound (ELBO) at last iteration.</p></dd>


<dt>progress</dt>
<dd><p>A data frame including information regarding
  convergence criteria at each iteration.</p></dd>


<dt>converged</dt>
<dd><p><code>TRUE</code> or <code>FALSE</code>, indicating whether
  the optimization algorithm converged to a solution within the chosen tolerance
  level.</p></dd>


<dt>Y</dt>
<dd><p>n x r matrix of responses at last iteration (only relevant when missing values
  are present in the input Y).</p></dd>

</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">###Set seed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###Simulate X and Y</span></span></span>
<span class="r-in"><span><span class="co">##Set parameters</span></span></span>
<span class="r-in"><span><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">p_causal</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###Simulate data</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_mr_mash_data.html">simulate_mr_mash_data</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">p</span>, <span class="va">p_causal</span>, <span class="va">r</span>, pve<span class="op">=</span><span class="fl">0.5</span>, B_cor<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                             B_scale<span class="op">=</span><span class="fl">1</span>, X_cor<span class="op">=</span><span class="fl">0</span>, X_scale<span class="op">=</span><span class="fl">1</span>, V_cor<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###Split the data in training and test sets</span></span></span>
<span class="r-in"><span><span class="va">Ytrain</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Xtrain</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Ytest</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Xtest</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###Specify the covariance matrices for the mixture-of-normals prior.</span></span></span>
<span class="r-in"><span><span class="va">univ_sumstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_univariate_sumstats.html">compute_univariate_sumstats</a></span><span class="op">(</span><span class="va">Xtrain</span>, <span class="va">Ytrain</span>,</span></span>
<span class="r-in"><span>                   standardize<span class="op">=</span><span class="cn">TRUE</span>, standardize.response<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="autoselect.mixsd.html">autoselect.mixsd</a></span><span class="op">(</span><span class="va">univ_sumstats</span>, mult<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">S0</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_canonical_covs.html">compute_canonical_covs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Ytrain</span><span class="op">)</span>, singletons<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             hetgrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">S0</span> <span class="op">&lt;-</span> <span class="fu"><a href="expand_covs.html">expand_covs</a></span><span class="op">(</span><span class="va">S0</span>, <span class="va">grid</span>, zeromat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###Fit mr.mash</span></span></span>
<span class="r-in"><span><span class="co"># Note that max_iter was set to 4 in this example to shorten</span></span></span>
<span class="r-in"><span><span class="co"># the running time. In practice, you should allow the model-fitting</span></span></span>
<span class="r-in"><span><span class="co"># algorithm to run for many more iterations to obtain better estimates.</span></span></span>
<span class="r-in"><span><span class="va">covY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Ytrain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xtrain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Ytrain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">mr.mash.rss</span><span class="op">(</span>Bhat<span class="op">=</span><span class="va">univ_sumstats</span><span class="op">$</span><span class="va">Bhat</span>, Shat<span class="op">=</span><span class="va">univ_sumstats</span><span class="op">$</span><span class="va">Shat</span>,</span></span>
<span class="r-in"><span>                   S0<span class="op">=</span><span class="va">S0</span>, covY<span class="op">=</span><span class="va">covY</span>, R<span class="op">=</span><span class="va">corX</span>, n<span class="op">=</span><span class="va">n_train</span>, V<span class="op">=</span><span class="va">covY</span>,</span></span>
<span class="r-in"><span>                   update_V<span class="op">=</span><span class="cn">TRUE</span>, X_colmeans<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">Xtrain</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   Y_colmeans<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">Ytrain</span><span class="op">)</span>, max_iter <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                   nthreads <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing the inputs... Done!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting the optimization algorithm... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  iter    mu1_max.diff     ELBO_diff               ELBO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1       1.94e+00            Inf      -1.17846672180838340864e+04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2       4.42e-01       4.05e+02      -1.13796024149418335583e+04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3       7.87e-02       2.57e+01      -1.13539336653549253242e+04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4       2.58e-02       2.82e+00      -1.13511145933636853442e+04</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Max number of iterations reached. Try increasing max_iter.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Done!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing the outputs... Done!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mr.mash.rss successfully executed in 0.007528051 minutes!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Predict the multivariate outcomes in the test set using the fitted model.</span></span></span>
<span class="r-in"><span><span class="va">Ytest_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>,<span class="va">Xtest</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Ytest_est</span>,<span class="va">Ytest</span>,pch <span class="op">=</span> <span class="fl">20</span>,col <span class="op">=</span> <span class="st">"darkblue"</span>,xlab <span class="op">=</span> <span class="st">"true"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"predicted"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>,b <span class="op">=</span> <span class="fl">1</span>,col <span class="op">=</span> <span class="st">"magenta"</span>,lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="mr.mash.rss-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Fabio Morgante, Deborah Kunkel, Peter Carbonetto, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

